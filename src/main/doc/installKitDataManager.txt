== Installation Kit Data Manager 1.5


[source,sh]
--------------------------------------
apt-get install postgresql

sudo apt-get install openjdk-8-jdk

sudo apt-get install tomcat7

sudo apt-get install rabbitmq-server

mkdir Downloads

cd Downloads/

wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-5.1.1.deb

sudo dpkg -i elasticsearch-5.1.1.deb

joe /etc/elasticsearch/elasticsearch.yml

  cluster.name: KITDataManager@masidev

Increasing number of open file descriptors (*skipped!*)

sudo /bin/systemctl daemon-reload

sudo /bin/systemctl enable elasticsearch.service

sudo /bin/systemctl start elasticsearch.service

copy KITDM-1.5.zip from external to Downloads
scp KITDM-1.5.zip root@141.76.16.249:/home/service/datamanager/Downloads

cd ..

apt install unzip

unzip Downloads/KITDM-1.5.zip 

sudo -u postgres psql postgres

postgres=# \password postgres
Enter new password: jeD9Eek5
Enter it again: jeD9Eek5

postgres=# CREATE DATABASE datamanager;

postgres=# \q

sudo -u postgres psql -U postgres -d datamanager -f sql/schema.sql 

sudo joe webapp/KITDM.xml 
<Context antiJARLocking="true" docBase="/home/service/datamanager/KITDM" path="/KITDM/"/>

sudo joe webapp/webdav.xml
<Context antiJARLocking="true" docBase="/home/service/datamanager/webdav" path=
<Realm className="org.apache.catalina.realm.LockOutRealm">
<Realm className="edu.kit.dama.tomcat.KITDMJdbcRealm" 
        driverName="org.postgresql.Driver"
        connectionName="postgres"
        connectionPassword="jeD9Eek5"
        connectionURL="jdbc:postgresql://localhost:5432/datamanager"/>
</Realm>
</Context>


sudo cp webapp/*.xml /var/lib/tomcat7/conf/Catalina/localhost/

sudo cp tomcat-ext/*.jar /usr/share/tomcat7/lib/

sudo chown tomcat7:tomcat7 /usr/share/tomcat7/lib/*.jar
 
joe KITDM/WEB-INF/classes/META-INF/persistence.xml 
4x edit database connection

joe KITDM/WEB-INF/classes/datamanager.xml

< 	<baseUrl>http://masidev.zih.tu-dresden.de:8080/</baseUrl>
---
> 	<baseUrl>http://HOSTNAME:8080/</baseUrl>
23c23
< 	<configLocation>/home/service/datamanager/simon/</configLocation>
---
> 	<configLocation>KITDM_LOCATION/simon/</configLocation>
30c30
< 	<cluster>KITDataManager@masidev</cluster>
---
> 	<cluster>KITDataManager@ELASTIC_HOST</cluster>
32c32
< 	<host>localhost</host>
---
> 	<host>ELASTIC_HOST</host>
106c106
<       <archiveUrl>file:///home/service/datamanager/archive</archiveUrl>
---
>       <archiveUrl>file://ARCHIVE_STORAGE</archiveUrl>
121c121
<     <restUrl>http://masidev.zih.tu-dresden.de:8080/KITDM/rest/staging/</restUrl>
---
>     <restUrl>http://HOSTNAME:8080/KITDM/rest/staging/</restUrl>
162,164c162,164
<   <jobStoreConnectionString>jdbc:postgresql://localhost:5432/datamanager</jobStoreConnectionString>
<   <jobStoreUser>postgres</jobStoreUser>
<   <jobStorePassword>jeD9Eek5</jobStorePassword>
---
>   <jobStoreConnectionString>jdbc:postgresql://DB_HOST:DB_PORT/DB_NAME</jobStoreConnectionString>
>   <jobStoreUser>DB_USER</jobStoreUser>
>   <jobStorePassword>DB_PASSWORD</jobStorePassword>

joe KITDM/WEB-INF/classes/logback.xml
<     <file>/home/service/datamanager/log/datamanager.log</file>
---
>     <file>${java.io.tmpdir}/datamanager.log</file>
16c16
<       <FileNamePattern>/home/service/datamanager/log/datamanager.%d{yyyy-MM-dd}.log</FileNamePattern>
---
>       <FileNamePattern>${java.io.tmpdir}/datamanager.%d{yyyy-MM-dd}.log</FileNamePattern>

mkdir log

joe KITDM/WEB-INF/web.xml 
Enable public access to viewname 'public'

chown -R tomcat7:tomcat7 .

Test elasticsearch:
 wget -qO- http://localhost:9200

Start tomcat
firefox http://localhost:8080/KITDM and
follow the Wizard: Volker Hartmann, dama@kit.edu, dama14
webdav: http://masidev.zih.tu-dresden.de:8080/webdav dama14

METS -> not yet!

Test webdav
firefox http://localhost:8080/webdav/USERS/ (Use e-mail and password from configuration before)

=== Install MetaStore Service
Copy zip files from outside:scp * root@141.76.16.249:/home/service/datamanager/Downloads


unzip Downloads/MetaStoreService-1.1-kitdm.zip 
mkdir KITDM/WEB-INF/lib/MASi/metastore/Backup
mv KITDM/WEB-INF/lib/MDM-Content-1.5.jar KITDM/WEB-INF/lib/MASi/metastore/Backup

root@masidev:/home/service/datamanager# ln KITDM/WEB-INF/lib/MASi/metastore/*.jar KITDM/WEB-INF/lib

Install ArangoDB:
cd Downloads
curl -O https://www.arangodb.com/repositories/arangodb31/xUbuntu_16.04/Release.key
apt-key add - < Release.key


echo 'deb https://www.arangodb.com/repositories/arangodb31/xUbuntu_16.04/ /' | sudo tee /etc/apt/sources.list.d/arangodb.list


sudo apt-get install apt-transport-https
sudo apt-get update
sudo apt-get install arangodb3=3.1.24
password: xooto2Oo

cd ..
joe  KITDM/WEB-INF/classes/DatabaseProperties.properties

arangoPort=8529
arangoDbName=MetaStoreDB
collections=MetaStoreRegistry
username=root
password=xooto2Oo
#debug To Delete DB each Time
dbDelete=false

cat KITDM/WEB-INF/web_metastore.xml 
joe KITDM/WEB-INF/web.xml 

Configure datamanager.xml
cat KITDM/WEB-INF/classes/datamanager_EPIC.xml 
joe KITDM/WEB-INF/classes/datamanager.xml
  Configure EPIC module

cat KITDM/WEB-INF/classes/META-INF/persistence_pid.xml 
joe KITDM/WEB-INF/classes/META-INF/persistence.xml 
        <!-- Additional class used by PID service -->
        <class>edu.kit.masi.pid.db.PidToDigitalObject</class> 

Configure MetadataSchema

sudo -u postgres psql -d datamanager
select * from metadataschema;
Nothing to do! :-)

=== Install MASi Processors
Copy zip files from outside:scp * root@141.76.16.249:/home/service/datamanager/Downloads
unzip Downloads/MDM-MasiProcessors-1.0-release.zip
bash MDM-MasiProcessors/install.sh 

=== Install CVMA
Copy zip files from outside:scp * root@141.76.16.249:/home/service/datamanager/Downloads
unzip Downloads/MDM-CVMA-1.1-SNAPSHOT-release.zip 
bash MDM-CVMA/install.sh

==== Install Exiftool
firefox  http://www.sno.phy.queensu.ca/~phil/exiftool/

Download tar.gz to Downloads.

cd tools/exiftool/
tar xzvf ../../Downloads/Image-ExifTool-10.59.tar.gz 
ln -s Image-ExifTool-10.59/ actual
cp .ExifTool_config actual
cd ../..
chown -R tomcat7:tomcat7 .

service tomcat7 restart

Initialize metadata indexer for all groups! 




--------------------------------------
